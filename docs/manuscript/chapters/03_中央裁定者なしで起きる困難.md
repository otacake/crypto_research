# 第3章: 中央裁定者なしで起きる困難

本章の目的は、中央裁定者なしの難しさを感想ではなく設計課題へ変換することです。結論を先に置きます。困難の中心は「誰が正しいか」ではなく、「観測差がある状況で、どう同じ履歴へ収束させるか」です。[一次:S-CH03-001]

## 1. 観測の不一致

中央裁定者なしの環境では、ノードごとの観測順が一致しません。原因は、レイテンシ差、経路差、再送差、処理キュー差です。同じ取引でも、どのノードが先に見たかは一致しないのが通常です。[一次:S-CH04-001]

破綻例を具体化します。

- 例1: Tx-A と Tx-B が同時近傍で送信され、N1にはA→B、N2にはB→Aで届く。
- 例2: N3では再送が発生してTx-Aが遅着し、N4では再送なしでTx-Aが先着する。
- 例3: 一時分断中に区画XとYで別候補が先着扱いになり、再接続後に衝突する。

三例の共通点は、悪意を仮定しなくても判定差が発生することです。したがって観測差は障害時の例外ではなく、平常時の設計入力です。[一次:S-CH03-001][一次:S-CH04-001]

素朴案として「通信を速くすれば解決する」と考えがちです。通信改善は有効ですが、観測差をゼロにはできません。ゼロでない限り競合逆転は残ります。設計課題は遅延の絶対値削減ではなく、遅延下でも判定が収束する規則設計です。

橋渡しを明示します。観測差が前提なら、次に問うべきは「どう並べればよいか」ではなく、「そもそも全部を並べられるのか」です。この問いが次節の部分順序につながります。[一次:S-CH03-001]

## 2. 部分順序

分散環境で自然に得られるのは全順序ではなく部分順序です。因果関係が明確なイベントは比較できますが、同時近傍で独立に観測されたイベントは比較不能のまま残ります。[一次:S-CH03-001]

ここで誤解を外します。部分順序は欠陥ではありません。分散観測の自然な帰結です。欠陥なのは、部分順序しか得られない世界で全順序が自動で得られると仮定する設計です。[一次:S-CH03-001]

破綻例を二つ置きます。

- 例A: 競合取引が同時近傍で投入され、候補集合がノード群ごとに異なる。比較不能部分を放置すると履歴候補が併存する。
- 例B: 分断再接続時に候補履歴が衝突する。優先規則が未定義だと拠点ごとに別履歴を維持してしまう。

この破綻から導く要件は、比較不能イベントを前提にして候補比較手順を公開規則として定義することです。比較不能を消すのではなく、比較不能があっても最終判定を共有できる手順を設計する必要があります。[一次:S-CH03-001]

部分順序から実務判定へ進む作業は三段です。第一に比較可能/比較不能を分離する。第二に比較不能候補への優先規則を定義する。第三に採択結果を公開履歴へ固定する。三段のどこかが曖昧だと、収束は一時的に見えても再接続時に再分裂します。

橋渡しを置きます。ここまでで「何が並ばないか」は分かりました。次に必要なのは、並ばない部分を含んだまま同じ採択へ寄せる合意手順です。これが次節の論点です。

## 3. 合意形成の難しさ

中央裁定者なしの合意形成が難しい理由は、善悪より情報条件です。参加者が協力的でも入力観測が異なれば出力判定は割れます。だから必要なのは、観測差込みで同じ判定へ寄る手順です。[一次:S-CH03-001]

素朴案として「多数決で決める」を置くと分かりやすいですが、多数決単体は不足します。投票対象、投票者集合、投票時点が揃わなければ、別々の多数が同時成立します（要検証）。

具体例を示します。

- 例1: 時点t1では候補 {A,B}、時点t2では {A,B,C} となり、時点ごとに多数結果が変わる。
- 例2: ノード集合N1とN2で受信済み候補が異なり、それぞれの集合内で別多数が成立する。
- 例3: 投票窓の長短が実装差でずれ、同じ規則名でも集計対象が一致しない。

この破綻から導く要件は、入力境界、比較窓、採択規則、棄却理由共有の四点を公開手順として固定することです。方式名より先に手順前提を固定しないと、方式導入後も収束保証は得られません。[一次:S-CH03-001]

ここで重要な条件対を置きます。短期一致と長期収束は同じではありません。短期一致はある時点の同調、長期収束は障害・再接続後も同履歴へ戻れる性質です。順序共有技術で必要なのは後者です。

橋渡し文を明示します。以上の破綻から、合意形成を評価するときは「いま揃っているか」だけでなく「崩れたあと戻れるか」を必ず確認する必要があります。この確認軸が次節の問題定式化へ直結します。

## 4. 問題定式化

本章の定式化を一文で固定します。問題は「誰の観測を採用するか」ではなく、「観測差があっても一致する公開規則を作れるか」です。[一次:S-CH03-001]

この定式化を採ると、後続章の役割が明確になります。第4章は観測差の発生源（伝播遅延）を扱い、第5章は比較単位（UTXO）を扱い、第6章は履歴固定（ブロック連結）を扱い、第7章は改ざんコスト（PoW）を扱います。章間はすべて「収束規則を成立させる部品」で接続できます。[一次:S-INTRO-001]

読者向けに、章末チェックを置きます。

1. 観測差は例外ではなく前提だと説明できるか。
2. 部分順序は欠陥ではなく自然な入力条件だと説明できるか。
3. 合意形成の核心が人格評価ではなく手順設計だと説明できるか。
4. 短期一致と長期収束を区別して説明できるか。

四点に答えられるなら、第3章の目的は達成です。

最後に次章への接続を明示します。第4章では、観測差の主要因であるP2P伝播遅延を、例外ではなく常態として扱います。ここで観測差を前提化できると、後続章を「技術部品の列挙」ではなく「収束条件の積み上げ」として読めます。[一次:S-CH04-001]

本章の結論を固定します。中央裁定者なしの困難は、観測差を消すことではなく、観測差を含んだまま同じ履歴へ収束させる規則を設計することにあります。[一次:S-CH03-001]

## 5. 後続章への変換規則

第3章の最後では、ここまでの困難を後続章の設計課題へ変換します。変換規則を持っておくと、章をまたいでも「いま何を解いているか」を見失いません。

変換は四段です。第一段は観測差の把握で、第4章が担当します。第二段は比較単位の固定で、第5章が担当します。第三段は履歴固定の公開で、第6章が担当します。第四段は改ざんコスト設計で、第7章が担当します。つまり第3章は、困難の説明章であると同時に、技術章への配線図です。[一次:S-CH04-001][一次:S-CH05-001][一次:S-CH06-001][一次:S-CH07-001]

ここで、読み方の失敗パターンを先に潰します。失敗1は、第4章を通信技術の章として孤立読解すること。失敗2は、第5章をデータ構造の暗記章として読むこと。失敗3は、第6章と第7章を安全性の重複説明として混同すること。これらの失敗は、困難→要件→部品の対応を見失ったときに起きます。

対応を明示し直します。第4章は「観測差がなぜ消えないか」を示し、第5章は「競合をどう同定するか」を示し、第6章は「同定結果をどう証拠化するか」を示し、第7章は「証拠を書き換えるコストをどう上げるか」を示します。各章が別の層を担当していると分かれば、重複して見える記述も役割分担として理解できます。

また、ここで運用観点も置きます。観測差を前提にする設計では、暫定判定と確定判定を分けて管理する必要があります。暫定判定を確定表示へ直結すると、再編成時の説明が破綻します。確定判定を遅らせ過ぎると、利用者体験が悪化します。したがって後続章では、収束性と可用性の両立を意識して読む必要があります（要検証）。

最後に、第3章の到達確認を置きます。1) 観測差を前提条件として説明できるか。2) 部分順序と全順序の違いを具体例で説明できるか。3) 多数決単体が不足する理由を手順前提で説明できるか。4) 第4〜第7章の役割を四段変換で言えるか。四点に答えられるなら、第3章は完了です。

本章の結論を再固定します。中央裁定者なしの困難は、乱雑さの問題ではありません。観測差を含んだ入力から、公開規則で同じ履歴へ収束させる設計の問題です。この定式化を保持したまま第4章へ進んでください。[一次:S-CH03-001]

## 6. 観測差から収束規則へ移る設計手順

第3章の最後に、観測差を実際の設計手順へ変換する流れを固定します。ここを固定すると、第4章以降の技術章で迷いにくくなります。

手順1は観測差の記述です。どのノード群で、どの時点に、どの順序差が起きるかを具体例で書きます。手順2は競合単位の定義です。何を同一入力競合とみなすか、何を独立イベントとみなすかを定義します。手順3は採択規則の定義です。競合時にどの条件を優先し、どの条件で棄却するかを公開手順にします。手順4は履歴固定と再検証です。採択結果を第三者が追試できる形で記録します。

この四手順のうち、手順1と手順2が弱い方式は、手順3をどれだけ洗練しても収束しません。理由は、比較対象が曖昧なままでは優先規則が適用できないからです。逆に手順3だけが弱い方式では、比較対象が明確でも最終採択が分裂します。さらに手順4が弱い方式では、採択が一致しても後から証明できません。だから四手順は連鎖として設計する必要があります。

ここで、読者がつまずきやすい点を先に書きます。第一のつまずきは「観測差は通信改善で消せる」と考えること。第二のつまずきは「多数決を入れれば収束する」と考えること。第三のつまずきは「履歴を保存していれば再検証できる」と考えることです。いずれも一部は正しいですが、それ単独では必要条件を満たしません。必要なのは、観測差・比較単位・採択規則・証拠化の同時設計です。

日常導入でこの連鎖を言い換えます。複数店舗で使えるクーポン運用を考えると、まずどの利用要求が同一クーポン競合かを定義し（手順2）、次に競合時の採択ルールを定義し（手順3）、最後に採択結果を監査可能な形で残す（手順4）必要があります。どれか一つ欠けると、後で「なぜこの利用を通して別の利用を止めたか」を説明できません。

もう一つ重要なのは、収束規則を「正しさの宣言」で終わらせないことです。収束規則は、障害時に実際に機能するかを検証して初めて規則になります。平常時のみ整合する規則は、規則ではなく平常時の経験則です。したがって第4章以降を読む際は、各部品が異常時にどう振る舞うかを必ず確認してください（要検証）。観測項目としては、分岐の同時存在時間、再編成深さ、再収束までの時間を最低限持つと、規則の実効性を比較しやすくなります（要検証）。

最後に、第3章の設計手順を一文で固定します。観測差の記述から始め、競合単位を定義し、採択規則を公開し、履歴を証拠化する。この四段を崩さないことが、中央裁定者なしで順序共有を成立させる最短手順です。[一次:S-CH03-001][一次:S-CH04-001]

補足として、設計手順を運用へ接続する観点を置きます。観測差を前提化した設計では、暫定状態と確定状態を混ぜないことが重要です。混ぜると再編成時に利用者説明が崩れます。分けると状態遷移を説明しやすくなります。さらに、棄却理由をコード化して共有すれば、障害時の調査速度を上げられます。第3章でこの運用接続まで押さえておくと、第4章以降の技術説明を「実装で終わらない設計」として読めます。[一次:S-CH03-001][一次:S-CH04-001]

最後に、章末の補足を統合して固定します。中央裁定者なしの難しさは、観測差が存在すること自体ではなく、観測差を含んだまま同じ履歴へ戻す仕組みを継続運用できるかにあります。したがって実装観点では、観測差を記録するログ粒度、競合発生時の初動テンプレート、棄却理由の共有形式を先に定義する必要があります。ログ粒度が粗いと収束規則の失敗と記録失敗を切り分けられず、初動テンプレートがないと観測差より先に対応差が拡大します。第3章の完了条件は、この切り分け可能性を保持したまま第4章へ接続できることです。この視点を維持すれば、後続章の技術部品をすべて「収束条件を満たすための部品」として読めます。[一次:S-CH03-001][一次:S-CH04-001]

補助的な確認として、章末で次の三問を確認してください。1) 観測差の発生源を二つ以上説明できるか。2) 部分順序から採択規則へ進む三段を説明できるか。3) 収束性と可用性を同時に評価する必要を説明できるか。三問に答えられるなら、第3章の定式化は実務判断へ接続できています。[一次:S-CH03-001]

もう一つ実務観点を置きます。収束規則の説明では、規則本文だけでなく「例外時の優先順位」を必ず定義してください。例外時優先順位が未定義だと、規則の解釈差が部署差へ変わり、部署差が履歴差へ拡大します。規則解釈を統一するためには、平常時仕様と障害時仕様を同じ文書体系で管理する必要があります。（要検証）
この運用統一を先に固定しておくことが、収束規則を現場で機能させる前提です。これを第3章の最終固定点として次章へ進みます。


追加で、観測差を扱う運用設計では「検知」「判定」「通知」を同じ粒度で記録することが有効です。検知だけ細かくても通知が粗いと利用者側で状態誤認が増えます。逆に通知だけ細かくても判定根拠が粗いと監査で再現できません。三層を同粒度で揃えることが、収束規則の実効性を維持する実務上の近道です。（要検証）
