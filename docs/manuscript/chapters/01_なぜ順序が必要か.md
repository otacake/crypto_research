# 第1章: なぜ順序が必要か

本章で確定する主張は明確です。順序共有は付加機能ではなく、重複利用を防ぎ、正当履歴を一本化するための必須条件です。[一次:S-CH01-001]

## 1. 二重支払いの具体例

制約条件を先に置きます。中央裁定者はいません。あなたが同じ1,000円相当を店Aと店Bに同時送信した場面を考えます。中央裁定者があるなら、最終的にどちらかを正当として確定できます。中央裁定者がないなら、だれが見ても同じ判定へ寄る公開規則が必要です。[一次:S-CH01-001]

この場面で起きるのが二重支払い（Double Spending）です。ここで誤解してはいけないのは、二重支払いが悪意の特殊事例だけを意味しないことです。観測差があるだけでも、同種の破綻は発生します。つまり問題の中心は人格ではなく、順序判定の共有可能性です。[一次:S-CH01-001][一次:S-CH03-001]

日常導入で具体化します。デジタルチケットを同時に二つの入場口で提示する場面を考えると、端末Aでは「先着で有効」、端末Bでも同様に「先着で有効」が成立することがあります。どちらも局所的には正しいのに、全体では単一チケットが二回使われた形になります。局所先着の正しさと全体整合の正しさは同じではありません。

ここで素朴案として「先着を採用すればよい」と言いたくなります。しかし先着は観測者依存です。ノード群N1では Tx-A 先着、N2では Tx-B 先着という逆転が起きるため、先着規則だけでは全体判定を一本化できません。[一次:S-CH04-001]

この破綻から橋渡しされる要件は、だれが先に見たかの競争ではなく、競合時の棄却理由を全参加者で共有できることです。棄却理由が共有されれば、後から同じ入力を再検証して同じ結論へ到達できます。順序共有の目的は速度競争ではなく、再現可能な正当判定です。[一次:S-CH01-001]

## 2. 順序なしの破綻

順序共有がない状態では、破綻は段階的に進みます。第一段階は観測差、第二段階は判定差、第三段階は履歴差です。履歴差まで進むと、利用者表示、内部台帳、監査記録の三者がずれ、運用補正が連鎖します。[一次:S-CH03-001]

破綻例を二つ以上、観測者・時点・結果で置きます。

- 破綻例A: 時点t0で Tx-A と Tx-B が送信される。時点t1で観測者N1は A→B、観測者N2は B→A と受信する。時点t2で双方が局所先着規則を適用すると、N1はAを正当、N2はBを正当と判定する。結果として同一入力に対して正当履歴が分裂する。
- 破綻例B: 時点u0でネットワークが一時分断し、区画Xと区画Yが独立に処理を進める。再接続時点u1で候補履歴が衝突するが、採択規則が公開されていないため、拠点ごとに別履歴を維持してしまう。結果として同じ取引集合から複数の「正当履歴」が併存する。

この二例の共通点は、悪意を仮定しなくても破綻が成立することです。したがって設計評価で先に問うべきは「攻撃者像」ではなく「平常時観測差を吸収できるか」です。平常時に吸収できない設計は、攻撃時にさらに不安定になります。[一次:S-CH03-001][一次:S-CH04-001]

橋渡しを明確化します。破綻例から導く必要条件は、候補取引を同じ形式で比較できること、競合時の棄却理由を共有できること、そして時間経過で同じ履歴へ寄る収束性を持つことです。この三つを先に固定しない限り、方式比較は印象論になります。

## 3. 時刻基準の限界

直感的な規則は「早い時刻を採る」です。送信時刻、受信時刻、検証時刻のいずれかを基準にして順序を決める発想です。しかし分散環境では、どの時刻を採用するか自体が一致しません。基準が一致しない規則は、規則名が同じでも結果が分裂します。[一次:S-CH03-001]

具体例を置きます。

- 例1: 送信者は Tx-A を先に送るが、経路差で N1 には A→B、N2 には B→A で届く。受信時刻基準では判定が割れる。
- 例2: N3 では再送が発生して Tx-A が遅着し、N4 では再送なしで Tx-A が先着する。検証時刻基準でも処理キュー差で逆転が起こる。

このとき「時刻の精度を上げる」だけでは問題を閉じられません。なぜなら問題の本体は時刻値ではなく、時刻参照基準の不一致だからです。参照基準を統一しない限り、時刻規則は観測差に引きずられます。[一次:S-CH04-001]

ここで誤解を外します。時刻情報は不要ではありません。時刻は補助情報として有用です。ただし最終判定を時刻単独へ依存させると、障害時に規則が割れやすくなります。最終判定は公開比較手順で固定し、時刻は補助に下げるべきです。[一次:S-CH03-001]

この破綻から橋渡しされる要件は、時刻を捨てることではなく、時刻依存を下げた比較規則を中核に置くことです。規則が中核を持てば、時刻差が残っても最終履歴を収束へ導けます。

## 4. 必要条件の抽出

本章で固定する必要条件を整理します。

1. 比較可能性: 候補取引を同じ粒度で比較できる。
2. 重複拒否性: 同一資産の重複消費を機械的に棄却できる。
3. 収束性: 観測差があっても最終的に同じ履歴へ寄る。
4. 再検証可能性: 判定手順と棄却理由を第三者が追試できる。

この四条件を満たさない方式は、順序問題を解いたとは言えません。[一次:S-CH01-001][一次:S-CH03-001]

ここで重要なのは順番です。先に方式名を選ばず、先に必要条件を固定します。条件を先に置くと、後続章のUTXO、ブロック連結、PoW、収束規則を「どの条件を担う部品か」で読めます。方式名先行だと、単語暗記に終わりやすくなります。[一次:S-INTRO-001]

必要条件を実務課題へ写像すると、比較可能性はデータモデル設計、重複拒否性は状態遷移設計、収束性は合意規則設計、再検証可能性は履歴公開設計に対応します。この写像を持っておけば、章をまたいでも論点がぶれません。

最後に次章への接続を明示します。第2章では中央裁定者ありの世界が、これらの条件を制度責任の集中でどう担保しているかを確認します。第3章では中央裁定者なしの世界で、同じ条件を規則設計へどう置換するかを確認します。[一次:S-CH02-001][一次:S-CH03-001]

本章の結論を固定します。順序共有は、二重支払い対策の一部ではなく、正当判定を成立させるための中核要件です。この結論を評価軸として保持したまま次章へ進みます。[一次:S-CH01-001]

## 5. 設計判断へ落とす

ここまでの議論を実際の設計判断へ落とします。第1章で得た四条件は、抽象論として置くだけでは効果がありません。実務では、どの条件がどの判断に対応するかを先に定義する必要があります。

対応を具体化します。比較可能性はデータ項目の正規化設計へ対応します。重複拒否性は状態遷移の一意化設計へ対応します。収束性は競合時採択規則の設計へ対応します。再検証可能性は監査証跡と説明文言の設計へ対応します。四条件をこの形で持つと、方式選定会議でも「どの条件を満たすための提案か」を明確に話せます。

ここで、誤配点を避けるための条件対を置きます。速い判定と正しい判定は同じではありません。短期一致と長期収束も同じではありません。局所最適と全体整合も同じではありません。第1章の価値は、この「似ているが違う」論点を分離することにあります。分離できれば、議論の途中で評価軸が入れ替わる事故を防げます。

日常導入をもう一つ置きます。物流倉庫で同一商品コードを同時に二件引き当てる場面を想像してください。倉庫Aと倉庫Bがそれぞれ局所在庫だけで判断すると、二重引当が起きます。中央在庫管理がなければ、どちらを先に確定するかを公開規則で決める必要があります。これは資産種別が違うだけで、順序共有問題の型は同じです。

この例からも分かるとおり、順序問題は暗号資産に固有の問題ではありません。中央裁定者なしで同一資源の排他利用を扱う場面なら、どこでも起こります。だから第1章で固定した評価軸は、方式が変わっても再利用できます。再利用できる軸を持つことが、本書の技術的到達点に直結します。

最後に、第1章の読後チェックを置きます。1) 二重支払いを悪意問題ではなく順序問題として説明できるか。2) 時刻規則単独の限界を二例で説明できるか。3) 四条件を後続章の部品に対応づけられるか。三つに答えられるなら、第1章は完了です。答えられない場合は、破綻例と橋渡し文だけを再読してから次章へ進んでください。順序を守ることが理解速度を最も大きく左右します。[一次:S-CH01-001][一次:S-CH03-001][一次:S-CH04-001]

## 6. 実務シミュレーション: 競合が起きたときに何が壊れるか

ここでは、第1章の要件を机上で終わらせないために、時系列シミュレーションで確認します。前提は単純です。送信者Sが同じ入力を使う二つの取引Tx-A/Tx-Bを送信し、ノード群N1/N2/N3がそれぞれ異なる到達順で受信します。N1はA先着、N2はB先着、N3は同時到達としてキュー順で処理すると仮定します。

このとき、順序共有規則が弱い設計では次の連鎖が起きます。第一段階で観測差が生まれ、第二段階で検証キュー順が分かれ、第三段階で有効候補が分かれ、第四段階で履歴候補が分かれます。連鎖は一段ずつ起きるため、初期段階では問題が見えにくいのが厄介です。運用者は「たまたま遅延しただけ」と判断しやすく、対策が後手になります。

さらに、利用者側の体験は局所成功として現れます。A側利用者には「成功」、B側利用者にも「成功」が返るため、短時間では矛盾が露出しません。矛盾が露出するのは照合フェーズです。照合フェーズで初めて同一入力の重複利用が確定し、どちらかを取り消す必要が生まれます。ここで順序共有規則がないと、取消基準すら一致せず、補正処理が再分裂します。

このシミュレーションから見えるのは、順序共有の失敗が「判定一回の失敗」ではなく「状態遷移全体の失敗」だという点です。だから第1章で必要条件を四つに分けました。比較可能性だけ、あるいは重複拒否性だけを強化しても、収束性や再検証可能性が弱ければ運用は崩れます。四条件は束として満たす必要があります。

次に、時刻規則を補助へ下げる理由をこのシミュレーションで再確認します。N1/N2/N3がそれぞれ正確な時計を持っていても、受信順自体が違えば「早い時刻」の定義は分かれます。時計精度を上げることは必要ですが、順序規則の代替にはなりません。順序規則は、時計の上に重ねる別の層として設計しなければ機能しません。

最後に、シミュレーションを設計判断へ変換する一文を固定します。競合時に必要なのは「どちらが本当に先か」を証明することではなく、「どの条件でどちらを採用するか」を公開規則として再現可能にすることです。この一文を保持できれば、第2章以降で制度責任と規則責任を比較しやすくなります。[一次:S-CH01-001][一次:S-CH03-001][一次:S-CH04-001]

補足として、章末の確認点を統合します。順序共有を評価するときは、①どの入力が競合か、②競合時に何を棄却するか、③棄却理由をどう共有するか、の三点を同時に確認してください。三点のうち一つでも曖昧なら、平常時に見えていた整合は障害時に崩れます。さらに、方式比較では「速いか遅いか」より先に「同じ入力から同じ結論が出るか」を確認する順番を守ってください。この順番を守るだけで議論の質は大きく上がります。第1章の結論は、順序共有の評価軸を固定し、その軸を後続章へ持ち運ぶことです。この軸を保持できれば、次章以降でも方式比較が印象論へ崩れません。[一次:S-CH01-001][一次:S-CH03-001]

この章を読み終えた時点で、読者は次の二つを言い換えられる必要があります。第一に、順序共有の問題は悪意の有無ではなく判定共有の有無だということ。第二に、時刻情報は補助にはなるが最終規則の代替にはならないということ。この二点が言えれば、第1章の評価軸は十分に固定されています。[一次:S-CH01-001][一次:S-CH03-001]

追加で、評価軸を実装選定に使うときの順序を置きます。最初に必要条件を満たすかを確認し、次に運用コストを比較し、最後に利用者説明の一貫性を比較してください。この順序を逆にすると、説明しやすい方式を先に採用して後から整合性要件が不足する事態が起きます。第1章の評価軸は、技術比較の前に比較順序を固定するためにも使えます。[一次:S-CH01-001]
